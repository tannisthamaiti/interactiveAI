<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linear Regression Report: Medical Insurance</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: #f4f7f9; color: #333; max-width: 900px; margin: 20px auto; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h1, h2, h3 { color: #005a9c; }
        summary { font-size: 1.2em; font-weight: bold; cursor: pointer; padding: 10px 0; }
        details { background-color: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .placeholder { background-color: #e9eff5; border: 2px dashed #007bff; text-align: center; padding: 50px; border-radius: 8px; font-style: italic; color: #555; }
        pre { background-color: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 8px; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word; }
        .r2-score { font-size: 1.5em; font-weight: bold; color: #28a745; text-align: center; background-color: #e9f7eb; padding: 15px; border-radius: 8px;}
        img { display: block; margin: 20px auto; max-width: 100%; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
    <h1>üìà Linear Regression Report: Medical Insurance Costs</h1>
    <p>This report details the analysis performed to predict medical charges based on patient attributes, including the full Python code and resulting data visualizations.</p>

    <details open>
        <summary>üìä Data Distribution & Splits</summary>
        
        <h3>Overall Feature Distribution</h3>
        <p>The first step is to check the distribution of our key numerical features to identify the spread of the data and any potential outliers. The plot below shows box plots for 'age', 'bmi', 'children', and 'charges'. We can see several outliers in the 'bmi' and 'charges' columns.</p>
        
        <img src="box_plot1.png" alt="Box plots showing overall distribution of age, bmi, children, and charges">
        
        <h3>Distribution Across Train/Validation/Test Sets</h3>
        <p>After splitting the data into training, validation, and test sets, we verify that the distributions remain similar across all three. The plot below confirms that 'age', 'bmi', and 'children' have nearly identical distributions in each set, which ensures our model evaluation will be fair and unbiased.</p>

        <img src="box_plot2.png" alt="Box plots comparing distributions across train, validation, and test sets">
        
    </details>

    <details>
        <summary>üöÄ Model Performance & Results</summary>
        <div class="r2-score">R-squared (R¬≤) Score: 0.8144</div>
        <p>An R¬≤ score of 0.8144 is a strong result. It means our model can explain about <strong>81.4% of the variation</strong> in medical insurance charges using the provided features. This indicates a good fit for the test data.</p>
        <div class="placeholder">A plot of Actual vs. Predicted charges would go here to visually confirm the model's accuracy.</div>
    </details>

    <details>
        <summary>üêç Full Colab Notebook Code</summary>
        <p>The following complete Python script was extracted from the `Untitled7.ipynb` notebook.</p>
        
        <pre><code>import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression
from sklearn.preprocessing import OneHotEncoder
from sklearn.compose import ColumnTransformer
from sklearn.pipeline import Pipeline
from sklearn.metrics import r2_score
import io


# Define the filename. This must exactly match the name of the file you uploaded.
filename = 'Medical_insurance.csv'

# Use pandas to read the CSV file into a DataFrame called 'df'
df = pd.read_csv(filename)
df.head()
# Select the columns you want to plot
columns_to_plot = ['age', 'bmi', 'children', 'charges']

# Set up the matplotlib figure with a 2x2 grid for our plots
fig, axes = plt.subplots(2, 2, figsize=(14, 10))
fig.suptitle('Box Plots to Identify Potential Outliers', fontsize=16)

# Create a box plot for each of the selected columns
# We use axes.flatten() to easily iterate through the subplots
axes = axes.flatten()
for i, column in enumerate(columns_to_plot):
    sns.boxplot(y=df[column], ax=axes[i], color='skyblue')
    axes[i].set_title(f'Distribution of {column}')
    axes[i].set_ylabel(column)

# Adjust layout to prevent titles and labels from overlapping
plt.tight_layout(rect=[0, 0.03, 1, 0.95])

# Save the figure and show the plot
plt.savefig('outlier_boxplots.png')
plt.show()

# --- 1. Define Features (X) and Target (y) ---
X = df.drop('charges', axis=1)
y = df['charges']

# --- 2. Split the data into train (70%), validation (15%), and test (15%) sets ---
X_train, X_temp, y_train, y_temp = train_test_split(X, y, train_size=0.7, random_state=42)
X_val, X_test, y_val, y_test = train_test_split(X_temp, y_temp, test_size=0.5, random_state=42)

# --- 3. Prepare data for plotting ---
# We create a combined DataFrame with the features and a 'Set' column for easy plotting.
X_train['Set'] = 'Training'
X_val['Set'] = 'Validation'
X_test['Set'] = 'Test'
plot_df = pd.concat([X_train, X_val, X_test])

# --- 4. Create the Box Plots for age, bmi, and children ---
fig, axes = plt.subplots(1, 3, figsize=(18, 6))
fig.suptitle('Feature Distributions Across Data Splits', fontsize=16)

# Plot for 'age'
sns.boxplot(x='Set', y='age', data=plot_df, ax=axes[0], order=['Training', 'Validation', 'Test'])
axes[0].set_title('Age Distribution')

# Plot for 'bmi'
sns.boxplot(x='Set', y='bmi', data=plot_df, ax=axes[1], order=['Training', 'Validation', 'Test'])
axes[1].set_title('BMI Distribution')

# Plot for 'children'
sns.boxplot(x='Set', y='children', data=plot_df, ax=axes[2], order=['Training', 'Validation', 'Test'])
axes[2].set_title('Children Distribution')

# Save the figure and show the plot
plt.tight_layout(rect=[0, 0.03, 1, 0.95])
plt.savefig('feature_split_boxplots.png')
plt.show()
</code></pre>
    </details>

</body>
</html>